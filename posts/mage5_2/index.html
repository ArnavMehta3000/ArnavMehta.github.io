<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="rgb(255,255,255)"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>MAGE - Part 5.2 &#183; Home</title>
<meta name=title content="MAGE - Part 5.2 &#183; Home"><meta name=description content="Making a game engine - Part 5.2 - Input Processing"><link rel=canonical href=https://arnavmehta3000.github.io/posts/mage5_2/><link type=text/css rel=stylesheet href=/css/main.bundle.min.d0f50305ba1cd0434125b56eed11e0d51e2d4d9028284503cb4f1791a5b39738.css integrity="sha256-0PUDBboc0ENBJbVu7RHg1R4tTZAoKEUDy08XkaWzlzg="><script type=text/javascript src=/js/appearance.min.022d0ebc3b46a335eb1c7ef79b7f2de143d7cd5156d433638592ef1ce5f8554e.js integrity="sha256-Ai0OvDtGozXrHH73m38t4UPXzVFW1DNjhZLvHOX4VU4="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.0b5cd3b9de5d174c12b262d5fc0f340317893762dc3ac21a174679d7a8670ee7.js integrity="sha256-C1zTud5dF0wSsmLV/A80AxeJN2LcOsIaF0Z516hnDuc=" data-copy=Copy data-copied=Copied></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://arnavmehta3000.github.io/posts/mage5_2/"><meta property="og:site_name" content="Home"><meta property="og:title" content="MAGE - Part 5.2"><meta property="og:description" content="Making a game engine - Part 5.2 - Input Processing"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-31T22:44:33+01:00"><meta property="article:modified_time" content="2024-03-31T22:44:33+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="MAGE - Part 5.2"><meta name=twitter:description content="Making a game engine - Part 5.2 - Input Processing"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"MAGE - Part 5.2","headline":"MAGE - Part 5.2","abstract":"Making a game engine - Part 5.2 - Input Processing","inLanguage":"en","url":"https:\/\/arnavmehta3000.github.io\/posts\/mage5_2\/","author":{"@type":"Person","name":"Arnav Mehta"},"copyrightYear":"2024","dateCreated":"2024-03-31T22:44:33\u002b01:00","datePublished":"2024-03-31T22:44:33\u002b01:00","dateModified":"2024-03-31T22:44:33\u002b01:00","mainEntityOfPage":"true","wordCount":"2189"}]</script><meta name=author content="Arnav Mehta"><link href=https://github.com/arnavmehta3000 rel=me><link href=https://linkedin.com/in/arnavmehta3000 rel=me><link href=https://twitter.com/its_me_arnav rel=me><link href=mailto:arnavdatt@gmail.com rel=me><script async src="https://www.googletagmanager.com/gtag/js?id=G-5KCVZLS061"></script><script>var doNotTrack=!1,dnt;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5KCVZLS061")}</script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold pe-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral print:hidden sm:py-10"><nav class="flex items-start justify-between sm:items-center"><div class="z-40 flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Home</a></div><label id=menu-button for=menu-controller class="block sm:hidden"><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="invisible fixed inset-0 z-30 m-auto h-full w-full cursor-default overflow-auto bg-neutral-100/50 opacity-0 backdrop-blur-sm transition-opacity dark:bg-neutral-900/50"><ul class="mx-auto flex w-full max-w-7xl list-none flex-col overflow-visible px-6 py-6 ltr:text-right rtl:text-left sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"><li class=mb-1><span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class="group mb-1"><a href=/aboutme/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About Me</span></a></li><li class="group mb-1"><a href=/projects/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Projects</span></a></li><li class="group mb-1"><a href=/posts/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Posts</span></a></li><li class="group mb-1"><button id=search-button-1 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></div></label><ul class="hidden list-none flex-row ltr:text-right rtl:text-left sm:flex"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/aboutme/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About Me</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/projects/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Projects</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/posts/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Posts</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><button id=search-button-2 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Home</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/mage5_2/>MAGE - Part 5.2</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">MAGE - Part 5.2</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8"><div class="toc pe-5 print:hidden lg:sticky lg:top-10"><details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5"><summary class="-ms-5 block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="-ms-5 border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#implementing-the-input-api>Implementing the Input API</a><ul><li><a href=#constructors>Constructors</a></li><li><a href=#input-window-procedure>Input Window Procedure</a><ul><li><a href=#initializing-the-input-system>Initializing the Input System</a></li></ul></li><li><a href=#mouse-input>Mouse Input</a><ul><li><a href=#capturing-raw-input>Capturing Raw Input</a></li><li><a href=#capturing-mouse-position>Capturing Mouse Position</a></li><li><a href=#capturing-mouse-wheel>Capturing Mouse Wheel</a></li><li><a href=#capturing-mouse-button-states>Capturing Mouse Button States</a></li></ul></li><li><a href=#keyboard-input>Keyboard Input</a><ul><li><a href=#capturing-key-states>Capturing Key States</a></li><li><a href=#processing-keyboard-modifiers>Processing Keyboard Modifiers</a></li></ul></li><li><a href=#helper-functions>Helper Functions</a><ul><li><a href=#is-virtual-key-pressed>Is Virtual Key Pressed</a></li><li><a href=#getting-key-modifiers>Getting Key Modifiers</a></li></ul></li><li><a href=#updating-the-input-system>Updating The Input System</a><ul><li><a href=#reset-input-state>Reset Input State</a></li><li><a href=#the-update-function>The Update function</a></li><li><a href=#on-window-focus-change>On Window Focus Change</a></li></ul></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose grow"><div class="lead !mb-9 text-xl">Capturing the keys (and clicks) to success!</div><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="pe-3 text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span><span class=dark:text-neutral-300>Check out Nui Engine on <a href=https://github.com/ArnavMehta3000/NuiEngine.git target=_blank rel="noreferrer noopener">Github</a></span></div><p>In the <a href=https://arnavmehta3000.github.io/posts/mage5_1/ target=_blank rel="noreferrer noopener">previous post</a>, I went over setting up the base for the input system. In this one we&rsquo;ll see how I implemented processing Win32 input events.</p><h2 id=implementing-the-input-api class="relative group">Implementing the Input API <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#implementing-the-input-api aria-label=Anchor>#</a></span></h2><p>I made a new file called <code>Input.h</code> and made the API functions for the input system</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>namespace</span> <span class=n>Nui</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>namespace</span> <span class=n>Input</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>namespace</span> <span class=n>Internal</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=na>[[nodiscard]]</span> <span class=kt>bool</span> <span class=n>ProcessInputWndProc</span><span class=p>(</span><span class=n>HWND</span> <span class=n>hWnd</span><span class=p>,</span> <span class=n>UINT</span> <span class=n>uMsg</span><span class=p>,</span> <span class=n>WPARAM</span> <span class=n>wParam</span><span class=p>,</span> <span class=n>LPARAM</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>			<span class=kt>void</span> <span class=nf>Update</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=na>[[nodiscard]]</span> <span class=k>const</span> <span class=n>Mouse</span><span class=o>::</span><span class=n>Point</span><span class=o>&amp;</span> <span class=n>GetMousePosition</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=na>[[nodiscard]]</span> <span class=k>const</span> <span class=n>Mouse</span><span class=o>::</span><span class=n>Point</span><span class=o>&amp;</span> <span class=n>GetMouseRawDelta</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=na>[[nodiscard]]</span> <span class=k>const</span> <span class=n>Mouse</span><span class=o>::</span><span class=n>WheelInfo</span><span class=o>&amp;</span> <span class=n>GetMouseWheelH</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=na>[[nodiscard]]</span> <span class=k>const</span> <span class=n>Mouse</span><span class=o>::</span><span class=n>WheelInfo</span><span class=o>&amp;</span> <span class=n>GetMouseWheelV</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=na>[[nodiscard]]</span> <span class=k>const</span> <span class=n>Mouse</span><span class=o>::</span><span class=n>ButtonState</span><span class=o>&amp;</span> <span class=n>GetMouseButton</span><span class=p>(</span><span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span> <span class=n>btn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=na>[[nodiscard]]</span> <span class=k>const</span> <span class=n>Mouse</span><span class=o>::</span><span class=n>ButtonState</span><span class=o>&amp;</span> <span class=n>GetMouseButton</span><span class=p>(</span><span class=n>U32</span> <span class=n>btn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=na>[[nodiscard]]</span> <span class=k>const</span> <span class=n>Keyboard</span><span class=o>::</span><span class=n>KeyState</span><span class=o>&amp;</span> <span class=n>GetKeyState</span><span class=p>(</span><span class=n>KeyCode</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In the cpp file I have the Keyboard and Mouse as static unique pointers along with a bunch of helper functions (that I&rsquo;ll cover later)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// In Input.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>static</span> <span class=kt>bool</span> <span class=n>s_initialized</span><span class=p>{</span> <span class=nb>false</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Mouse</span><span class=o>&gt;</span> <span class=n>s_mouse</span><span class=p>{</span> <span class=k>nullptr</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Keyboard</span><span class=o>&gt;</span> <span class=n>s_keyboard</span><span class=p>{</span> <span class=k>nullptr</span> <span class=p>};</span>
</span></span></code></pre></div><h3 id=constructors class="relative group">Constructors <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#constructors aria-label=Anchor>#</a></span></h3><p>From the Keyboard and Mouse structures made in the last post, each had a constexpr constructor, which we can use to initialize thier internal state.</p><p>Starting with the simple mouse constructor:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>constexpr</span> <span class=n>Mouse</span><span class=o>::</span><span class=n>Mouse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=n>Position</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>,</span> <span class=n>RawDelta</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>,</span> <span class=n>WheelH</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>,</span> <span class=n>WheelV</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ButtonStates</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>ButtonState</span><span class=p>(</span><span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=n>Left</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ButtonStates</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>ButtonState</span><span class=p>(</span><span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=n>Right</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ButtonStates</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>ButtonState</span><span class=p>(</span><span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=n>Middle</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ButtonStates</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>ButtonState</span><span class=p>(</span><span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=n>MouseX1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ButtonStates</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>ButtonState</span><span class=p>(</span><span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=n>MouseX2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Followed by an annoyingly large Keyboard constructor (shortened for this post):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>constexpr</span> <span class=n>Keyboard</span><span class=o>::</span><span class=n>Keyboard</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>KeyStates</span><span class=p>[</span><span class=n>ConvertKeyCodeToArrayIndex</span><span class=p>(</span><span class=n>KeyCode</span><span class=o>::</span><span class=n>LeftArrow</span><span class=p>)]</span>      <span class=o>=</span> <span class=n>KeyState</span><span class=p>(</span><span class=n>KeyCode</span><span class=o>::</span><span class=n>LeftArrow</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>KeyStates</span><span class=p>[</span><span class=n>ConvertKeyCodeToArrayIndex</span><span class=p>(</span><span class=n>KeyCode</span><span class=o>::</span><span class=n>RightArrow</span><span class=p>)]</span>     <span class=o>=</span> <span class=n>KeyState</span><span class=p>(</span><span class=n>KeyCode</span><span class=o>::</span><span class=n>RightArrow</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>KeyStates</span><span class=p>[</span><span class=n>ConvertKeyCodeToArrayIndex</span><span class=p>(</span><span class=n>KeyCode</span><span class=o>::</span><span class=n>UpArrow</span><span class=p>)]</span>        <span class=o>=</span> <span class=n>KeyState</span><span class=p>(</span><span class=n>KeyCode</span><span class=o>::</span><span class=n>UpArrow</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span>
</span></span><span class=line><span class=cl>    <span class=n>KeyStates</span><span class=p>[</span><span class=n>ConvertKeyCodeToArrayIndex</span><span class=p>(</span><span class=n>KeyCode</span><span class=o>::</span><span class=n>NumPadMultiply</span><span class=p>)]</span> <span class=o>=</span> <span class=n>KeyState</span><span class=p>(</span><span class=n>KeyCode</span><span class=o>::</span><span class=n>NumPadMultiply</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>KeyStates</span><span class=p>[</span><span class=n>ConvertKeyCodeToArrayIndex</span><span class=p>(</span><span class=n>KeyCode</span><span class=o>::</span><span class=n>NumPadSubtract</span><span class=p>)]</span> <span class=o>=</span> <span class=n>KeyState</span><span class=p>(</span><span class=n>KeyCode</span><span class=o>::</span><span class=n>NumPadSubtract</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>KeyStates</span><span class=p>[</span><span class=n>ConvertKeyCodeToArrayIndex</span><span class=p>(</span><span class=n>KeyCode</span><span class=o>::</span><span class=n>NumPadAdd</span><span class=p>)]</span>      <span class=o>=</span> <span class=n>KeyState</span><span class=p>(</span><span class=n>KeyCode</span><span class=o>::</span><span class=n>NumPadAdd</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=input-window-procedure class="relative group">Input Window Procedure <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#input-window-procedure aria-label=Anchor>#</a></span></h3><p>The first thing to do in the input system is to capture the Win32 messages. And since I am using a namespace, it was quite easy to hook into the the window procedure I made in the last post.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>LRESULT</span> <span class=n>Window</span><span class=o>::</span><span class=n>MessageHandler</span><span class=p>(</span><span class=n>HWND</span> <span class=n>hWnd</span><span class=p>,</span> <span class=n>UINT</span> <span class=n>uMsg</span><span class=p>,</span> <span class=n>WPARAM</span> <span class=n>wParam</span><span class=p>,</span> <span class=n>LPARAM</span> <span class=n>lParam</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//  Existing code
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>Input</span><span class=o>::</span><span class=n>Internal</span><span class=o>::</span><span class=n>ProcessInputWndProc</span><span class=p>(</span><span class=n>hWnd</span><span class=p>,</span> <span class=n>uMsg</span><span class=p>,</span> <span class=n>wParam</span><span class=p>,</span> <span class=n>lParam</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Message was processed by input system
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Return default window procedure
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h4 id=initializing-the-input-system class="relative group">Initializing the Input System <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#initializing-the-input-system aria-label=Anchor>#</a></span></h4><p>Using the static bool declared above we can initialize the input system on the first function call (like a do-once function). So inside the input window procedure, I create the mouse and keyboard objects and register raw mouse input using <a href=https://learn.microsoft.com/en-us/windows/win32/inputdev/using-raw-input target=_blank rel="noreferrer noopener">MSDN as reference</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// If input system has not been initialized, register raw input devices but don&#39;t process input
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=na>[[unlikely]]</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>s_initialized</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>s_mouse</span>    <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Mouse</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>s_keyboard</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Keyboard</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Register for raw input
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>RAWINPUTDEVICE</span> <span class=n>Rid</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>Rid</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>usUsagePage</span> <span class=o>=</span> <span class=n>HID_USAGE_PAGE_GENERIC</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Rid</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>usUsage</span>     <span class=o>=</span> <span class=n>HID_USAGE_GENERIC_MOUSE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Rid</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>dwFlags</span>     <span class=o>=</span> <span class=n>RIDEV_INPUTSINK</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Rid</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>hwndTarget</span>  <span class=o>=</span> <span class=n>hWnd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>RegisterRawInputDevices</span><span class=p>(</span><span class=n>Rid</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>Rid</span><span class=p>[</span><span class=mi>0</span><span class=p>])))</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Log error 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Consider input initialized even if registration failed (it&#39;s not fatal)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>s_initialized</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=mouse-input class="relative group">Mouse Input <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#mouse-input aria-label=Anchor>#</a></span></h3><h4 id=capturing-raw-input class="relative group">Capturing Raw Input <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#capturing-raw-input aria-label=Anchor>#</a></span></h4><p>After registering the raw mouse device, we can use the <code>WM_INPUT</code> to get the raw mouse data and store it in our mouse structure.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_INPUT</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>U32</span> <span class=n>dwSize</span> <span class=o>=</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>RAWINPUT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>static</span> <span class=n>BYTE</span> <span class=n>lpb</span><span class=p>[</span><span class=k>sizeof</span><span class=p>(</span><span class=n>RAWINPUT</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>::</span><span class=n>GetRawInputData</span><span class=p>((</span><span class=n>HRAWINPUT</span><span class=p>)</span><span class=n>lParam</span><span class=p>,</span> <span class=n>RID_INPUT</span><span class=p>,</span> <span class=n>lpb</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>dwSize</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>RAWINPUTHEADER</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>RAWINPUT</span><span class=o>*</span> <span class=n>raw</span> <span class=o>=</span> <span class=p>(</span><span class=n>RAWINPUT</span><span class=o>*</span><span class=p>)</span><span class=n>lpb</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=na>[[likely]]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>raw</span> <span class=o>&amp;&amp;</span> <span class=n>raw</span><span class=o>-&gt;</span><span class=n>header</span><span class=p>.</span><span class=n>dwType</span> <span class=o>==</span> <span class=n>RIM_TYPEMOUSE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>NUI_ASSERT</span><span class=p>((</span><span class=kt>bool</span><span class=p>)</span><span class=n>s_mouse</span><span class=p>,</span> <span class=s>&#34;Mouse is not initialized&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=na>[[likely]]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>s_mouse</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>RawDelta</span><span class=p>.</span><span class=n>X</span> <span class=o>=</span> <span class=n>raw</span><span class=o>-&gt;</span><span class=n>data</span><span class=p>.</span><span class=n>mouse</span><span class=p>.</span><span class=n>lLastX</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>RawDelta</span><span class=p>.</span><span class=n>Y</span> <span class=o>=</span> <span class=n>raw</span><span class=o>-&gt;</span><span class=n>data</span><span class=p>.</span><span class=n>mouse</span><span class=p>.</span><span class=n>lLastY</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=capturing-mouse-position class="relative group">Capturing Mouse Position <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#capturing-mouse-position aria-label=Anchor>#</a></span></h4><p>This one is quite easy where where we can simply capture the <code>WM_MOUSEMOVE</code> message to get the mouse position relative to the client window.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_MOUSEMOVE</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>s_mouse</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>POINTS</span> <span class=n>p</span> <span class=o>=</span> <span class=n>MAKEPOINTS</span><span class=p>(</span><span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>Position</span><span class=p>.</span><span class=n>X</span> <span class=o>=</span> <span class=n>p</span><span class=p>.</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>Position</span><span class=p>.</span><span class=n>Y</span> <span class=o>=</span> <span class=n>p</span><span class=p>.</span><span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=capturing-mouse-wheel class="relative group">Capturing Mouse Wheel <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#capturing-mouse-wheel aria-label=Anchor>#</a></span></h4><p>Using the <code>WM_MOUSEWHEEL</code> and <code>WM_MOUSEHWHEEL</code> messages along with the <code>GET_WHEEL_DELTA_WPARAM()</code> to get the wheel movement direction/delta. I also have a helper function called <code>GetModifiers()</code> to get the modifier keys that were pressed when the mouse wheel message is received.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_MOUSEWHEEL</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>s_mouse</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>WheelV</span><span class=p>.</span><span class=n>Delta</span> <span class=o>=</span> <span class=n>GET_WHEEL_DELTA_WPARAM</span><span class=p>(</span><span class=n>wParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>WheelV</span><span class=p>.</span><span class=n>Modifier</span> <span class=o>=</span> <span class=n>GetModifiers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>POINTS</span> <span class=n>p</span> <span class=o>=</span> <span class=n>MAKEPOINTS</span><span class=p>(</span><span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>WheelV</span><span class=p>.</span><span class=n>Position</span><span class=p>.</span><span class=n>X</span> <span class=o>=</span> <span class=n>p</span><span class=p>.</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>WheelV</span><span class=p>.</span><span class=n>Position</span><span class=p>.</span><span class=n>Y</span> <span class=o>=</span> <span class=n>p</span><span class=p>.</span><span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_MOUSEHWHEEL</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>s_mouse</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>WheelH</span><span class=p>.</span><span class=n>Delta</span> <span class=o>=</span> <span class=n>GET_WHEEL_DELTA_WPARAM</span><span class=p>(</span><span class=n>wParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>WheelH</span><span class=p>.</span><span class=n>Modifier</span> <span class=o>=</span> <span class=n>GetModifiers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>POINTS</span> <span class=n>p</span> <span class=o>=</span> <span class=n>MAKEPOINTS</span><span class=p>(</span><span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>WheelH</span><span class=p>.</span><span class=n>Position</span><span class=p>.</span><span class=n>X</span> <span class=o>=</span> <span class=n>p</span><span class=p>.</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>WheelH</span><span class=p>.</span><span class=n>Position</span><span class=p>.</span><span class=n>Y</span> <span class=o>=</span> <span class=n>p</span><span class=p>.</span><span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=capturing-mouse-button-states class="relative group">Capturing Mouse Button States <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#capturing-mouse-button-states aria-label=Anchor>#</a></span></h4><p>One of the helper functions I made was to process mouse button states, here is the function</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>ProcessMouseButton</span><span class=p>(</span><span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span> <span class=n>btn</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>pressed</span><span class=p>,</span> <span class=n>LPARAM</span> <span class=n>lParam</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>s_mouse</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>POINTS</span> <span class=n>p</span> <span class=o>=</span> <span class=n>MAKEPOINTS</span><span class=p>(</span><span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>Position</span><span class=p>.</span><span class=n>X</span> <span class=o>=</span> <span class=n>p</span><span class=p>.</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>Position</span><span class=p>.</span><span class=n>Y</span> <span class=o>=</span> <span class=n>p</span><span class=p>.</span><span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Mouse</span><span class=o>::</span><span class=n>ButtonState</span><span class=o>&amp;</span> <span class=n>state</span> <span class=o>=</span> <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>ButtonStates</span><span class=p>[</span><span class=n>Mouse</span><span class=o>::</span><span class=n>ConvertMouseButtonToArrayIndex</span><span class=p>(</span><span class=n>btn</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>        <span class=n>NUI_ASSERT</span><span class=p>(</span><span class=n>state</span><span class=p>.</span><span class=n>Btn</span> <span class=o>==</span> <span class=n>btn</span><span class=p>,</span> <span class=s>&#34;Input button and mouse state button mismatch!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>.</span><span class=n>Modifier</span> <span class=o>=</span> <span class=n>GetModifiers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>pressed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>state</span><span class=p>.</span><span class=n>IsHeld</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>state</span><span class=p>.</span><span class=n>IsPressed</span>  <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>state</span><span class=p>.</span><span class=n>IsHeld</span>     <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>state</span><span class=p>.</span><span class=n>IsReleased</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Button was not pressed this frame
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>state</span><span class=p>.</span><span class=n>IsPressed</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>  <span class=c1>// Set pressed to false if the button is already held
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsPressed</span>  <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsHeld</span>     <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsReleased</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Here I first get the mouse position whenever the mouse button is pressed. If the button was pressed this frame then I set the pressed and held value to true and released to false provided the button is not being held (pressed in a previous frame). If the button is not being pressed then I set the pressed and held to false and released to true.</p><blockquote><p>I will be using the same logic for keyboard input to set key states</p></blockquote><p>After that we can use this function in the input window procedure:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_LBUTTONDOWN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ProcessMouseButton</span><span class=p>(</span><span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=n>Left</span><span class=p>,</span> <span class=nb>true</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_MBUTTONDOWN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ProcessMouseButton</span><span class=p>(</span><span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=n>Middle</span><span class=p>,</span> <span class=nb>true</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_RBUTTONDOWN</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ProcessMouseButton</span><span class=p>(</span><span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=n>Right</span><span class=p>,</span> <span class=nb>true</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_LBUTTONUP</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ProcessMouseButton</span><span class=p>(</span><span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=n>Left</span><span class=p>,</span> <span class=nb>false</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_MBUTTONUP</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ProcessMouseButton</span><span class=p>(</span><span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=n>Middle</span><span class=p>,</span> <span class=nb>false</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_RBUTTONUP</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ProcessMouseButton</span><span class=p>(</span><span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=n>Right</span><span class=p>,</span> <span class=nb>false</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_XBUTTONDOWN</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span> <span class=n>btn</span> <span class=o>=</span> <span class=p>(</span><span class=n>HIWORD</span><span class=p>(</span><span class=n>wParam</span><span class=p>)</span> <span class=o>==</span> <span class=n>XBUTTON1</span><span class=p>)</span> <span class=o>?</span> <span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=nl>MouseX1</span> <span class=p>:</span> <span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=n>MouseX2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>ProcessMouseButton</span><span class=p>(</span><span class=n>btn</span><span class=p>,</span> <span class=nb>true</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_XBUTTONUP</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span> <span class=n>btn</span> <span class=o>=</span> <span class=p>(</span><span class=n>HIWORD</span><span class=p>(</span><span class=n>wParam</span><span class=p>)</span> <span class=o>==</span> <span class=n>XBUTTON1</span><span class=p>)</span> <span class=o>?</span> <span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=nl>MouseX1</span> <span class=p>:</span> <span class=n>Mouse</span><span class=o>::</span><span class=n>Button</span><span class=o>::</span><span class=n>MouseX2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>ProcessMouseButton</span><span class=p>(</span><span class=n>btn</span><span class=p>,</span> <span class=nb>false</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=keyboard-input class="relative group">Keyboard Input <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#keyboard-input aria-label=Anchor>#</a></span></h3><h4 id=capturing-key-states class="relative group">Capturing Key States <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#capturing-key-states aria-label=Anchor>#</a></span></h4><p>Windows only gives two top level types of key state information, whether the key was pressed this frame (key down) or the key was released this frame (key up). Each of these messages are of two types: <em>keyboard keys</em> and <em>system keys</em>. We can capture them using <code>WM_SYSKEYDOWN</code>, <code>WM_KEYDOWN</code>, <code>WM_SYSKEYUP</code> and <code>WM_KEYUP</code> messages.</p><p>For processing key down messages:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_SYSKEYDOWN</span><span class=p>:</span> <span class=na>[[fallthrough]]</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_KEYDOWN</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>NUI_ASSERT</span><span class=p>((</span><span class=kt>bool</span><span class=p>)</span><span class=n>s_keyboard</span><span class=p>,</span> <span class=s>&#34;Keyboard is not initialized&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=na>[[likely]]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>U64</span><span class=p>)</span><span class=n>wParam</span> <span class=o>&lt;</span> <span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Process some modifiers early
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>ProcessKeyboard</span><span class=p>(</span><span class=n>wParam</span><span class=p>,</span> <span class=nb>true</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Keyboard</span><span class=o>::</span><span class=n>KeyState</span><span class=o>&amp;</span> <span class=n>state</span> <span class=o>=</span> <span class=n>s_keyboard</span><span class=o>-&gt;</span><span class=n>KeyStates</span><span class=p>[</span><span class=n>ConvertKeyCodeToArrayIndex</span><span class=p>((</span><span class=n>KeyCode</span><span class=p>)</span><span class=n>wParam</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>        <span class=n>NUI_ASSERT</span><span class=p>(</span><span class=n>state</span><span class=p>.</span><span class=n>Key</span> <span class=o>==</span> <span class=n>KeyCode</span><span class=p>(</span><span class=n>wParam</span><span class=p>),</span> <span class=s>&#34;WPARAM is not a KeyCode&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>state</span><span class=p>.</span><span class=n>IsHeld</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsPressed</span>  <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsHeld</span>     <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsReleased</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsPressed</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>  <span class=c1>// Set pressed to false if the key is already held
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>.</span><span class=n>Modifier</span> <span class=o>=</span> <span class=n>GetModifiers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Similarly for key up messages</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_SYSKEYUP</span><span class=p>:</span> <span class=na>[[fallthrough]]</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=nl>WM_KEYUP</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>NUI_ASSERT</span><span class=p>((</span><span class=kt>bool</span><span class=p>)</span><span class=n>s_keyboard</span><span class=p>,</span> <span class=s>&#34;Keyboard is not initialized&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=na>[[likely]]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>U64</span><span class=p>)</span><span class=n>wParam</span> <span class=o>&lt;</span> <span class=mi>256</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Process some modifiers early
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>ProcessKeyboard</span><span class=p>(</span><span class=n>wParam</span><span class=p>,</span> <span class=nb>true</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Keyboard</span><span class=o>::</span><span class=n>KeyState</span><span class=o>&amp;</span> <span class=n>state</span> <span class=o>=</span> <span class=n>s_keyboard</span><span class=o>-&gt;</span><span class=n>KeyStates</span><span class=p>[</span><span class=n>ConvertKeyCodeToArrayIndex</span><span class=p>(</span><span class=n>KeyCode</span><span class=p>(</span><span class=n>wParam</span><span class=p>))];</span>
</span></span><span class=line><span class=cl>        <span class=n>NUI_ASSERT</span><span class=p>(</span><span class=n>state</span><span class=p>.</span><span class=n>Key</span> <span class=o>==</span> <span class=n>KeyCode</span><span class=p>(</span><span class=n>wParam</span><span class=p>),</span> <span class=s>&#34;WPARAM is not a KeyCode&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>.</span><span class=n>IsPressed</span>  <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>.</span><span class=n>IsHeld</span>     <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>.</span><span class=n>IsReleased</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The above two code snippets are very similar to the mouse button state code. So I will not go in depth about explaining them. At the same time you must have noticed a function called <code>ProcessKeyboard</code>, this function is used to process some modifier keys early.</p><h4 id=processing-keyboard-modifiers class="relative group">Processing Keyboard Modifiers <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#processing-keyboard-modifiers aria-label=Anchor>#</a></span></h4><p>So this is weird function that does almost the same thing as the above code, but with a slight difference, it calculates which side of the modifier key was pressed (left or right).</p><p>Here is complete function body, with explanations below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>ProcessKeyboard</span><span class=p>(</span><span class=n>U64</span> <span class=n>vk</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>pressed</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=n>handled</span>  <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=n>doVKDown</span> <span class=o>=</span> <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=n>U64</span> <span class=n>vk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Keyboard</span><span class=o>::</span><span class=n>KeyState</span><span class=o>&amp;</span> <span class=n>state</span> <span class=o>=</span> <span class=n>s_keyboard</span><span class=o>-&gt;</span><span class=n>KeyStates</span><span class=p>[</span><span class=n>ConvertKeyCodeToArrayIndex</span><span class=p>((</span><span class=n>KeyCode</span><span class=p>)</span><span class=n>VK_LSHIFT</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>state</span><span class=p>.</span><span class=n>IsHeld</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsPressed</span>  <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsHeld</span>     <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsReleased</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsPressed</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>  <span class=c1>// Set pressed to false if the key is already held
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>.</span><span class=n>Modifier</span> <span class=o>=</span> <span class=n>GetModifiers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=n>doVKUp</span> <span class=o>=</span> <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=n>U64</span> <span class=n>vk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Keyboard</span><span class=o>::</span><span class=n>KeyState</span><span class=o>&amp;</span> <span class=n>state</span> <span class=o>=</span> <span class=n>s_keyboard</span><span class=o>-&gt;</span><span class=n>KeyStates</span><span class=p>[</span><span class=n>ConvertKeyCodeToArrayIndex</span><span class=p>((</span><span class=n>KeyCode</span><span class=p>)</span><span class=n>VK_LSHIFT</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>.</span><span class=n>IsPressed</span>  <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>.</span><span class=n>IsHeld</span>     <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>.</span><span class=n>IsReleased</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>.</span><span class=n>Modifier</span>   <span class=o>=</span> <span class=n>GetModifiers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>vk</span> <span class=o>==</span> <span class=n>VK_SHIFT</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_LSHIFT</span><span class=p>)</span> <span class=o>==</span> <span class=n>pressed</span><span class=p>)</span> <span class=n>doVKDown</span><span class=p>(</span><span class=n>VK_LSHIFT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=n>doVKUp</span><span class=p>(</span><span class=n>VK_LSHIFT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_RSHIFT</span><span class=p>)</span> <span class=o>==</span> <span class=n>pressed</span><span class=p>)</span> <span class=n>doVKDown</span><span class=p>(</span><span class=n>VK_RSHIFT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=n>doVKUp</span><span class=p>(</span><span class=n>VK_RSHIFT</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>handled</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>vk</span> <span class=o>==</span> <span class=n>VK_CONTROL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_LCONTROL</span><span class=p>)</span> <span class=o>==</span> <span class=n>pressed</span><span class=p>)</span> <span class=n>doVKDown</span><span class=p>(</span><span class=n>VK_LCONTROL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=n>doVKUp</span><span class=p>(</span><span class=n>VK_LCONTROL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_RCONTROL</span><span class=p>)</span> <span class=o>==</span> <span class=n>pressed</span><span class=p>)</span> <span class=n>doVKDown</span><span class=p>(</span><span class=n>VK_RCONTROL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=n>doVKUp</span><span class=p>(</span><span class=n>VK_RCONTROL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>handled</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>vk</span> <span class=o>==</span> <span class=n>VK_MENU</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_LMENU</span><span class=p>)</span> <span class=o>==</span> <span class=n>pressed</span><span class=p>)</span> <span class=n>doVKDown</span><span class=p>(</span><span class=n>VK_LMENU</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=n>doVKUp</span><span class=p>(</span><span class=n>VK_LMENU</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_RMENU</span><span class=p>)</span> <span class=o>==</span> <span class=n>pressed</span><span class=p>)</span> <span class=n>doVKDown</span><span class=p>(</span><span class=n>VK_RMENU</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=n>doVKUp</span><span class=p>(</span><span class=n>VK_RMENU</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>handled</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>handled</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Here there are two lambdas called <code>doVKUp</code> and <code>doVKDown</code>. These lambdas perform the exact same logic as earlier to capture the key/mouse states. But the main job of the function of this function is to decide what key to call those functions for. That is decided by the if-chain below the lambdas.</p><p>Within each if statement, I first check for the <em>&rsquo;top-level&rsquo;</em> key code regarding what modifier key was pressed. Then using a helper function called <code>IsVkPressed</code> (explained later), I check if the key is being pressed or not, which decides which lambda is to be called for which side of the modifier key.</p><h3 id=helper-functions class="relative group">Helper Functions <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#helper-functions aria-label=Anchor>#</a></span></h3><p>In this post you would have seen two functions that I refer to as <em>&lsquo;Helper Functions&rsquo;</em>. Here is what they are and what they do:</p><h4 id=is-virtual-key-pressed class="relative group">Is Virtual Key Pressed <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#is-virtual-key-pressed aria-label=Anchor>#</a></span></h4><p>The first helper function is <code>IVKPressed</code>, this function is simply a wrapper around the Win32 function <code>GetKeyState</code> and checks if a virtual key is up or down.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>static</span> <span class=kt>bool</span> <span class=nf>IsVKPressed</span><span class=p>(</span><span class=n>I32</span> <span class=n>vk</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=o>::</span><span class=n>GetKeyState</span><span class=p>(</span><span class=n>vk</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0x8000</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=getting-key-modifiers class="relative group">Getting Key Modifiers <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#getting-key-modifiers aria-label=Anchor>#</a></span></h4><p>The other helper function that I use is the <code>GetModifiers</code> function. This function returns a <code>Modifier</code> enum. It makes use of the above <code>IsVKPressed</code> function to check for modifier keys</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>static</span> <span class=n>Modifier</span> <span class=nf>GetModifiers</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>U64</span> <span class=n>m</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>  <span class=c1>// Modifier::None
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_LSHIFT</span><span class=p>))</span>   
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>|=</span> <span class=n>Modifier</span><span class=o>::</span><span class=n>MOD_LShift</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_RSHIFT</span><span class=p>))</span>   
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>|=</span> <span class=n>Modifier</span><span class=o>::</span><span class=n>MOD_RShift</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_LCONTROL</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>|=</span> <span class=n>Modifier</span><span class=o>::</span><span class=n>MOD_LControl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_RCONTROL</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>|=</span> <span class=n>Modifier</span><span class=o>::</span><span class=n>MOD_RControl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_LMENU</span><span class=p>))</span>    
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>|=</span> <span class=n>Modifier</span><span class=o>::</span><span class=n>MOD_LAlt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_RMENU</span><span class=p>))</span>    
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>|=</span> <span class=n>Modifier</span><span class=o>::</span><span class=n>MOD_RAlt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_LWIN</span><span class=p>))</span>     
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>|=</span> <span class=n>Modifier</span><span class=o>::</span><span class=n>MOD_LSuper</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>IsVKPressed</span><span class=p>(</span><span class=n>VK_RWIN</span><span class=p>))</span>     
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>|=</span> <span class=n>Modifier</span><span class=o>::</span><span class=n>MOD_RSuper</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=n>Modifier</span><span class=o>&gt;</span><span class=p>(</span><span class=n>m</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=updating-the-input-system class="relative group">Updating The Input System <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#updating-the-input-system aria-label=Anchor>#</a></span></h3><p>Although input messages will be recieved by the window thanks to the window message pump. But we want to manually be able to reset the internal input state of the entire keyboard and mouse (for example when the window loses focus).</p><h4 id=reset-input-state class="relative group">Reset Input State <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#reset-input-state aria-label=Anchor>#</a></span></h4><p>Here is the function that resets the internal input state of the keyboard and mouse by setting all members to their default values. It also takes a boolean in as an argument to check if we want to reset the held state of the keys/buttons as well (explained later).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=nf>Reset</span><span class=p>(</span><span class=kt>bool</span> <span class=n>resetHeld</span> <span class=o>=</span> <span class=nb>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>[[likely]]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>s_keyboard</span><span class=p>)</span>  <span class=c1>// Reset keyboard
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=k>auto</span><span class=o>&amp;</span> <span class=nl>state</span><span class=p>:</span> <span class=n>s_keyboard</span><span class=o>-&gt;</span><span class=n>KeyStates</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsPressed</span>  <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsReleased</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>resetHeld</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>state</span><span class=p>.</span><span class=n>IsHeld</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=na>[[likely]]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>s_mouse</span><span class=p>)</span> <span class=c1>// Reset mouse
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=k>auto</span><span class=o>&amp;</span> <span class=nl>state</span><span class=p>:</span> <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>ButtonStates</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsPressed</span>  <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>.</span><span class=n>IsReleased</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>resetHeld</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>state</span><span class=p>.</span><span class=n>IsHeld</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>WheelH</span> <span class=o>=</span> <span class=n>Mouse</span><span class=o>::</span><span class=n>WheelInfo</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>s_mouse</span><span class=o>-&gt;</span><span class=n>WheelV</span> <span class=o>=</span> <span class=n>Mouse</span><span class=o>::</span><span class=n>WheelInfo</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><h4 id=the-update-function class="relative group">The Update function <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-update-function aria-label=Anchor>#</a></span></h4><p>This is a very simple update function that we call every frame that simply calls the above <code>Reset</code>. Here we do not want to reset the &lsquo;held-state&rsquo; of the keys/buttons since we yet do not know if they have been released or not.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=n>Internal</span><span class=o>::</span><span class=n>Update</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Reset</span><span class=p>(</span><span class=nb>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=on-window-focus-change class="relative group">On Window Focus Change <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#on-window-focus-change aria-label=Anchor>#</a></span></h4><p>Whenever our window loses focus, we want to reset the keyboard and mouse state. We can do this using the Win32 function called <code>GetFocus</code> which returns a window handle. We can compare this handle with our window handle and check if the window that has focus is our window (else tour window is not being focused). That can be checked for in the input window procedure function after the initialization code and before the the actual input processing takes place. And if we are going to reset here, then we we want to reset the held state of the keys/buttons as well.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>bool</span> <span class=n>Internal</span><span class=o>::</span><span class=n>ProcessInputWndProc</span><span class=p>(</span><span class=n>HWND</span> <span class=n>hWnd</span><span class=p>,</span> <span class=n>UINT</span> <span class=n>uMsg</span><span class=p>,</span> <span class=n>WPARAM</span> <span class=n>wParam</span><span class=p>,</span> <span class=n>LPARAM</span> <span class=n>lParam</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Initialization code...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// Check for window focus
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=na>[[unlikely]]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>::</span><span class=n>GetFocus</span><span class=p>()</span> <span class=o>!=</span> <span class=n>hWnd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Reset</span><span class=p>(</span><span class=nb>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Switch statement on uMsg to capture input
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h2 id=conclusion class="relative group">Conclusion <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#conclusion aria-label=Anchor>#</a></span></h2><p>One thing I have not included in these posts is the function bodies of the Input getter functions since they are quite straight forward. For keyboard, you convert the input key to an array index and return the state of the key. Similarly, do the same with the mouse getter functions.</p><p>This input system can now be used as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Input</span><span class=o>::</span><span class=n>Keyboard</span><span class=o>::</span><span class=n>KeyState</span><span class=o>&amp;</span> <span class=n>state</span> <span class=o>=</span> <span class=n>Input</span><span class=o>::</span><span class=n>GetKeyState</span><span class=p>(</span><span class=n>Input</span><span class=o>::</span><span class=n>KeyCode</span><span class=o>::</span><span class=n>Escape</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>state</span><span class=p>.</span><span class=n>IsPressed</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Escape key was pressed this frame do something...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>Making an input system from scratch is quite a tedious task, not in complexity, but in lines of code. First you have to declare all the keys and buttons you want to support and create a mapping for each one of them. Then actually process the them. I&rsquo;ll agree that my implementation may not be the best (especially with mapping keycodes to array indices). But I always wanted to understand how input systems are writen and wanted to write one myself from scratch. So here we are.</p><div style=display:flex;flex-wrap:wrap;gap:10px><span class=flex><span class="ms-1 rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Programming
</span></span><span class=flex><span class="ms-1 rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Game Engine
</span></span><span class=flex><span class="ms-1 rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">C++
</span></span><span class=flex><span class="ms-1 rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Input</span></span></div></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/posts/mage5_1/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">MAGE - Part 5.1</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"></span></span></a></span><span></span></div></div></footer></article><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2024
Arnav Mehta</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher-0 type=button aria-label="appearance switcher"><div class="flex h-12 w-12 items-center justify-center dark:hidden" title="Switch to dark appearance"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden h-12 w-12 items-center justify-center dark:flex" title="Switch to light appearance"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://arnavmehta3000.github.io/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>