<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="rgb(255,255,255)"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>MAGE - Part 4 &#183; Home</title>
<meta name=title content="MAGE - Part 4 &#183; Home"><meta name=description content="Making a game engine - Part 4 - Windowing"><link rel=canonical href=https://arnavmehta3000.github.io/posts/mage4/><link type=text/css rel=stylesheet href=/css/main.bundle.min.d0f50305ba1cd0434125b56eed11e0d51e2d4d9028284503cb4f1791a5b39738.css integrity="sha256-0PUDBboc0ENBJbVu7RHg1R4tTZAoKEUDy08XkaWzlzg="><script type=text/javascript src=/js/appearance.min.022d0ebc3b46a335eb1c7ef79b7f2de143d7cd5156d433638592ef1ce5f8554e.js integrity="sha256-Ai0OvDtGozXrHH73m38t4UPXzVFW1DNjhZLvHOX4VU4="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.b1f8d2a7796afc4797afcc2b7f81e78f0810f3e8fca1b900c33ead64c354def8.js integrity="sha256-sfjSp3lq/EeXr8wrf4HnjwgQ8+j8obkAwz6tZMNU3vg=" data-copy=Copy data-copied=Copied></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:url" content="https://arnavmehta3000.github.io/posts/mage4/"><meta property="og:site_name" content="Home"><meta property="og:title" content="MAGE - Part 4"><meta property="og:description" content="Making a game engine - Part 4 - Windowing"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-19T19:59:57+00:00"><meta property="article:modified_time" content="2024-03-19T19:59:57+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="MAGE - Part 4"><meta name=twitter:description content="Making a game engine - Part 4 - Windowing"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"MAGE - Part 4","headline":"MAGE - Part 4","abstract":"Making a game engine - Part 4 - Windowing","inLanguage":"en","url":"https:\/\/arnavmehta3000.github.io\/posts\/mage4\/","author":{"@type":"Person","name":"Arnav Mehta"},"copyrightYear":"2024","dateCreated":"2024-03-19T19:59:57\u002b00:00","datePublished":"2024-03-19T19:59:57\u002b00:00","dateModified":"2024-03-19T19:59:57\u002b00:00","mainEntityOfPage":"true","wordCount":"2237"}]</script><meta name=author content="Arnav Mehta"><link href=https://github.com/arnavmehta3000 rel=me><link href=https://linkedin.com/in/arnavmehta3000 rel=me><link href=https://twitter.com/its_me_arnav rel=me><link href=mailto:arnavdatt@gmail.com rel=me><script async src="https://www.googletagmanager.com/gtag/js?id=G-5KCVZLS061"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5KCVZLS061")}</script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold pe-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral print:hidden sm:py-10"><nav class="flex items-start justify-between sm:items-center"><div class="z-40 flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Home</a></div><label id=menu-button for=menu-controller class="block sm:hidden"><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="invisible fixed inset-0 z-30 m-auto h-full w-full cursor-default overflow-auto bg-neutral-100/50 opacity-0 backdrop-blur-sm transition-opacity dark:bg-neutral-900/50"><ul class="mx-auto flex w-full max-w-7xl list-none flex-col overflow-visible px-6 py-6 ltr:text-right rtl:text-left sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"><li class=mb-1><span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class="group mb-1"><a href=/aboutme/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About Me</span></a></li><li class="group mb-1"><a href=/projects/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Projects</span></a></li><li class="group mb-1"><a href=/posts/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Posts</span></a></li><li class="group mb-1"><button id=search-button-1 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></div></label><ul class="hidden list-none flex-row ltr:text-right rtl:text-left sm:flex"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/aboutme/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About Me</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/projects/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Projects</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/posts/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Posts</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><button id=search-button-2 title="Search (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Home</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/mage4/>MAGE - Part 4</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">MAGE - Part 4</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8"><div class="toc pe-5 print:hidden lg:sticky lg:top-10"><details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5"><summary class="-ms-5 block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="-ms-5 border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#window-styling>Window Styling</a></li><li><a href=#the-window-class>The Window Class</a><ul><li><a href=#registering-window-class>Registering Window Class</a></li><li><a href=#centring-the-window>Centring The Window</a></li><li><a href=#creating-the-window>Creating The Window</a></li><li><a href=#applying-styling>Applying Styling</a></li><li><a href=#window-message-pump>Window Message Pump</a><ul><li><a href=#window-procedure>Window Procedure</a></li><li><a href=#message-router>Message Router</a></li><li><a href=#message-handler>Message Handler</a></li><li><a href=#manual-hit-testing>Manual Hit Testing</a></li></ul></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose grow"><div class="lead !mb-9 text-xl">Windows made by Windows!</div><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="pe-3 text-primary-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span><span class=dark:text-neutral-300>Check out Nui Engine on <a href=https://github.com/ArnavMehta3000/NuiEngine.git target=_blank rel="noreferrer noopener">Github</a></span></div><p>Now that I have a logging and assertion framework up and running. The next thing I want to add is an application window. For this I will be using the Win32 API and no external libraries. Here is what I want my window class to support:</p><ul><li>Simple styling</li><li>Custom title text</li><li>Self contained message pump</li><li>Message routing (with callbacks)</li></ul><h2 id=window-styling class="relative group">Window Styling <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#window-styling aria-label=Anchor>#</a></span></h2><p>I will be supporting 4 different window styles</p><ul><li>Windowed</li><li>Windowed Fullscreem</li><li>Borderless</li><li>Borderless Fullscreem</li></ul><p>These are the high level styles which are exposed to the end user. They map to an internal style enum class which enables certain styles (like window drop shadows).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// User facing styles (part of Window class)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>enum</span> <span class=k>class</span> <span class=nc>Style</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Windowed</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>Windowed</span> <span class=n>Fullscreem</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>Borderless</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>Borderless</span> <span class=n>Fullscreem</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In the .cpp file, hidden from the end user there is an internal style enum:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>enum</span> <span class=nc>StyleInternal</span> <span class=o>:</span> <span class=n>DWORD</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Windowed</span>             <span class=o>=</span> <span class=n>WS_OVERLAPPEDWINDOW</span> <span class=o>|</span> <span class=n>WS_THICKFRAME</span> <span class=o>|</span> <span class=n>WS_CAPTION</span> <span class=o>|</span> <span class=n>WS_SYSMENU</span> <span class=o>|</span> <span class=n>WS_MINIMIZEBOX</span> <span class=o>|</span> <span class=n>WS_MAXIMIZEBOX</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>WindowedFullscreen</span>   <span class=o>=</span> <span class=n>Windowed</span> <span class=o>|</span> <span class=n>WS_MAXIMIZE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>AeroBorderless</span>       <span class=o>=</span> <span class=n>WS_POPUP</span> <span class=o>|</span> <span class=cm>/*WS_THICKFRAME |*/</span> <span class=n>WS_CAPTION</span> <span class=o>|</span> <span class=n>WS_SYSMENU</span> <span class=o>|</span> <span class=n>WS_MAXIMIZEBOX</span> <span class=o>|</span> <span class=n>WS_MINIMIZEBOX</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>BasicBorderless</span>      <span class=o>=</span> <span class=n>WS_POPUP</span> <span class=o>|</span> <span class=cm>/*WS_THICKFRAME |*/</span> <span class=n>WS_SYSMENU</span> <span class=o>|</span> <span class=n>WS_MAXIMIZEBOX</span> <span class=o>|</span> <span class=n>WS_MINIMIZEBOX</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>BorderlessFullscreen</span> <span class=o>=</span> <span class=n>WS_MAXIMIZE</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>// Borderless styles have no WS_THICKFRAME to disable window resizing (we will handle that manually later)
</span></span></span></code></pre></div><p>WHen making my window I use a <strong>style proxy</strong> which strips fullscreen inforamtion from the style. Allowing me to then convert the new style to an internal window style and manually fullscreen the window if needed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Returns a stripped window style and tells if the style contained fullscreen flag
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Window</span><span class=o>::</span><span class=n>Style</span> <span class=n>GetStyleProxy</span><span class=p>(</span><span class=n>Window</span><span class=o>::</span><span class=n>Style</span> <span class=n>style</span><span class=p>,</span> <span class=kt>bool</span><span class=o>&amp;</span> <span class=n>outIsFullscreen</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Window</span><span class=o>::</span><span class=n>Style</span> <span class=n>styleProxy</span> <span class=o>=</span> <span class=n>style</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>outIsFullscreen</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>styleProxy</span> <span class=o>==</span> <span class=n>Window</span><span class=o>::</span><span class=n>Style</span><span class=o>::</span><span class=n>WindowedFullscreen</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>outIsFullscreen</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>styleProxy</span> <span class=o>=</span> <span class=n>Window</span><span class=o>::</span><span class=n>Style</span><span class=o>::</span><span class=n>Windowed</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=nf>if</span> <span class=p>(</span><span class=n>styleProxy</span> <span class=o>==</span> <span class=n>Window</span><span class=o>::</span><span class=n>Style</span><span class=o>::</span><span class=n>BorderlessFullscreen</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>outIsFullscreen</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>styleProxy</span> <span class=o>=</span> <span class=n>Window</span><span class=o>::</span><span class=n>Style</span><span class=o>::</span><span class=n>Borderless</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>style</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Now that I have our proxy style, I need to convert this to the internal style and this is done using these three functions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>IsCompositionEnabled</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>BOOL</span> <span class=n>compositionEnabled</span> <span class=o>=</span> <span class=n>FALSE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=n>success</span> <span class=o>=</span> <span class=o>::</span><span class=n>DwmIsCompositionEnabled</span><span class=p>(</span><span class=o>&amp;</span><span class=n>compositionEnabled</span><span class=p>)</span> <span class=o>==</span> <span class=n>S_OK</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>compositionEnabled</span> <span class=o>&amp;&amp;</span> <span class=n>success</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>StyleInternal</span> <span class=nf>GetBorderlessStyle</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>IsCompositionEnabled</span><span class=p>()</span> <span class=o>?</span> <span class=n>StyleInternal</span><span class=o>::</span><span class=nl>AeroBorderless</span> <span class=p>:</span> <span class=n>StyleInternal</span><span class=o>::</span><span class=n>BasicBorderless</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>StyleInternal</span> <span class=nf>ConvertStyle</span><span class=p>(</span><span class=n>Window</span><span class=o>::</span><span class=n>Style</span> <span class=n>style</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>style</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>Window</span><span class=o>::</span><span class=n>Style</span><span class=o>::</span><span class=nl>Windowed</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>StyleInternal</span><span class=o>::</span><span class=n>Windowed</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>Window</span><span class=o>::</span><span class=n>Style</span><span class=o>::</span><span class=nl>WindowedFullscreen</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>StyleInternal</span><span class=o>::</span><span class=n>WindowedFullscreen</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>Window</span><span class=o>::</span><span class=n>Style</span><span class=o>::</span><span class=nl>Borderless</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>Window</span><span class=o>::</span><span class=n>Style</span><span class=o>::</span><span class=nl>BorderlessFullscreen</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>GetBorderlessStyle</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>StyleInternal</span><span class=o>::</span><span class=n>Windowed</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>AeroBorderless</code> are the new types of windows which have <em>Desktop Window Manager Composition</em> toggled (available after Windows 8). Making all Borderless windows <code>AeroBordless</code> by default. Becuase of this some extra work will have to be done to handle window resizing (assuming WS_THICKFRAME is enabled).</p><blockquote><p>One could say that I can simply use enums (instead of enum classes) and bit mask flags instead of doing all these unecessary conversions. And you are probably right. But I wrote this code at 4 AM, heavily sleep deprived. And sleepy me thought this was a great idea and I stuck with it. Now its too late to go back and to be honest I am kinda proud of this mess XD.</p></blockquote><h2 id=the-window-class class="relative group">The Window Class <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-window-class aria-label=Anchor>#</a></span></h2><p>Now that I have the window styling logic out of the way. I can start creating the window itself. Starting with the constructor and the destructor</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>static</span> <span class=k>const</span> <span class=n>StringW</span> <span class=n>s_windowClassName</span> <span class=o>=</span> <span class=sa>L</span><span class=s>&#34;NuiApp&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Window</span><span class=o>::</span><span class=n>Window</span><span class=p>(</span><span class=n>Window</span><span class=o>::</span><span class=n>Style</span> <span class=n>style</span><span class=p>,</span> <span class=n>StringViewW</span> <span class=n>title</span><span class=p>,</span> <span class=n>Window</span><span class=o>::</span><span class=n>Size</span> <span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>:</span> <span class=n>m_style</span><span class=p>(</span><span class=n>style</span><span class=p>)</span>                      <span class=c1>// Window::Style
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>,</span> <span class=n>m_title</span><span class=p>(</span><span class=n>title</span><span class=p>)</span>                      <span class=c1>// Wide string for window title
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>,</span> <span class=n>m_size</span><span class=p>(</span><span class=n>size</span><span class=p>)</span>                        <span class=c1>// Structure containing sizeX and sizeY
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>,</span> <span class=n>m_hWnd</span><span class=p>(</span><span class=k>nullptr</span><span class=p>)</span>                     <span class=c1>// Window handle
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>,</span> <span class=n>m_isFocused</span><span class=p>(</span><span class=nb>false</span><span class=p>)</span>                  <span class=c1>// Bool to check if window has focus
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>,</span> <span class=n>m_hInstance</span><span class=p>(</span><span class=n>GetModuleHandle</span><span class=p>(</span><span class=nb>NULL</span><span class=p>))</span>  <span class=c1>// Application instance handle
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>MakeWindow</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Window</span><span class=o>::~</span><span class=n>Window</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>::</span><span class=n>DestroyWindow</span><span class=p>(</span><span class=n>m_hWnd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=o>::</span><span class=n>UnregisterClass</span><span class=p>(</span><span class=n>s_windowClassName</span><span class=p>.</span><span class=n>c_str</span><span class=p>(),</span> <span class=n>m_hInstance</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The constructor calls the <code>MakeWindow</code> function which handles window creation which contains the following steps.</p><h3 id=registering-window-class class="relative group">Registering Window Class <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#registering-window-class aria-label=Anchor>#</a></span></h3><p>The first step to creating a Win32 window is to register a window class. You can have multiple (actual) windows part of a window class.</p><p>Here I register a window class, where:</p><ul><li>The window redraw&rsquo;s if the width or height changes (see <a href=https://learn.microsoft.com/en-us/windows/win32/winmsg/window-class-styles target=_blank rel="noreferrer noopener">window class styles</a>)</li><li>The window uses a static Windows Procedure (explained later)</li><li>The background is white</li><li>The cursor is the default cursor</li></ul><p>The class is then registered using the <code>RegisterClassExW</code> function. This may fail is the class is already registered (which is not a problem), so I simply log that as an error and try to continue. If this was a breaking failure, then the next function where I create a window will fail whose error code will correspond to the window class registeration,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Register window class
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>WNDCLASSEXW</span> <span class=n>wcx</span><span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=n>wcx</span><span class=p>.</span><span class=n>cbSize</span>        <span class=o>=</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>wcx</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>wcx</span><span class=p>.</span><span class=n>style</span>         <span class=o>=</span> <span class=n>CS_HREDRAW</span> <span class=o>|</span> <span class=n>CS_VREDRAW</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>wcx</span><span class=p>.</span><span class=n>hInstance</span>     <span class=o>=</span> <span class=n>m_hInstance</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>wcx</span><span class=p>.</span><span class=n>lpfnWndProc</span>   <span class=o>=</span> <span class=n>WndProc</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>wcx</span><span class=p>.</span><span class=n>lpszClassName</span> <span class=o>=</span> <span class=n>s_windowClassName</span><span class=p>.</span><span class=n>c_str</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>wcx</span><span class=p>.</span><span class=n>hbrBackground</span> <span class=o>=</span> <span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=n>HBRUSH</span><span class=o>&gt;</span><span class=p>(</span><span class=n>COLOR_WINDOW</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>wcx</span><span class=p>.</span><span class=n>hCursor</span>       <span class=o>=</span> <span class=o>::</span><span class=n>LoadCursorW</span><span class=p>(</span><span class=k>nullptr</span><span class=p>,</span> <span class=n>IDC_ARROW</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!::</span><span class=n>RegisterClassExW</span><span class=p>(</span><span class=o>&amp;</span><span class=n>wcx</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Log error but try to continue regardless
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>NUI_LOG</span><span class=p>(</span><span class=n>Error</span><span class=p>,</span> <span class=n>Window</span><span class=p>,</span> <span class=s>&#34;Failed to register window class. &#34;</span><span class=p>,</span> <span class=n>GetWin32ErrorString</span><span class=p>(</span><span class=n>GetLastError</span><span class=p>()));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=centring-the-window class="relative group">Centring The Window <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#centring-the-window aria-label=Anchor>#</a></span></h3><p>This is a completely optional step. I like all muy windows to be created at the centre of the screen.</p><p>Using the Win32 API to get the desktop window rect. Then using that RECT to calculate the <code>x</code> and <code>y</code> coordinates to place my window (based on the provided window size).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>RECT</span> <span class=n>desktopRect</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>::</span><span class=n>GetWindowRect</span><span class=p>(</span><span class=o>::</span><span class=n>GetDesktopWindow</span><span class=p>(),</span> <span class=o>&amp;</span><span class=n>desktopRect</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>I32</span> <span class=n>posX</span> <span class=o>=</span> <span class=p>(</span><span class=n>desktopRect</span><span class=p>.</span><span class=n>right</span> <span class=o>/</span> <span class=mi>2</span><span class=p>)</span> <span class=o>-</span> <span class=p>(</span><span class=n>m_size</span><span class=p>.</span><span class=n>X</span> <span class=o>/</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>I32</span> <span class=n>posY</span> <span class=o>=</span> <span class=p>(</span><span class=n>desktopRect</span><span class=p>.</span><span class=n>bottom</span> <span class=o>/</span> <span class=mi>2</span><span class=p>)</span> <span class=o>-</span> <span class=p>(</span><span class=n>m_size</span><span class=p>.</span><span class=n>Y</span> <span class=o>/</span> <span class=mi>2</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=creating-the-window class="relative group">Creating The Window <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#creating-the-window aria-label=Anchor>#</a></span></h3><p>This is the part where the window is actually created. Again using the Win32 API.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>StyleInternal</span> <span class=n>style</span> <span class=o>=</span> <span class=n>ConvertStyle</span><span class=p>(</span><span class=n>m_style</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>m_hWnd</span> <span class=o>=</span> <span class=o>::</span><span class=n>CreateWindowExW</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=mi>0</span><span class=p>,</span>                          <span class=c1>// No extended styles
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>s_windowClassName</span><span class=p>.</span><span class=n>c_str</span><span class=p>(),</span>  <span class=c1>// Registered WNDCLASSEXW name
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>m_title</span><span class=p>.</span><span class=n>c_str</span><span class=p>(),</span>            <span class=c1>// Title of the window
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>style</span><span class=p>,</span>                      <span class=c1>// Converted internal style
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>posX</span><span class=p>,</span> <span class=n>posY</span><span class=p>,</span>                 <span class=c1>// Position of the window
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>m_size</span><span class=p>.</span><span class=n>X</span><span class=p>,</span> <span class=n>m_size</span><span class=p>.</span><span class=n>Y</span><span class=p>,</span>         <span class=c1>// Size of the window
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>nullptr</span><span class=p>,</span>                    <span class=c1>// No parent
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>nullptr</span><span class=p>,</span>                    <span class=c1>// No menu
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>m_hInstance</span><span class=p>,</span>                <span class=c1>// Application instance
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span>                        <span class=c1>// LPARAM
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>NUI_ASSERT</span><span class=p>(</span><span class=n>m_hWnd</span><span class=p>,</span> <span class=s>&#34;Failed to create window, handle is nullptr&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>Here I pass <code>this</code> as the <strong>LPARAM</strong>, since I will later be using that to route the window messages to the class memer functions</p><h3 id=applying-styling class="relative group">Applying Styling <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#applying-styling aria-label=Anchor>#</a></span></h3><p>Now that I have the window finally created, it is time to apply the styling I have ranting about from the start.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Get style proxy (we will be using this to apply styles)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>bool</span> <span class=n>fullscreen</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Style</span> <span class=n>styleProxy</span> <span class=o>=</span> <span class=n>GetStyleProxy</span><span class=p>(</span><span class=n>m_style</span><span class=p>,</span> <span class=n>fullscreen</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// We are modifying the style only if the window style is borderless
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=n>HasStyleFlag</span><span class=p>((</span><span class=n>DWORD</span><span class=p>)</span><span class=n>styleProxy</span><span class=p>,</span> <span class=p>(</span><span class=n>DWORD</span><span class=p>)</span><span class=n>Style</span><span class=o>::</span><span class=n>Borderless</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>StyleInternal</span> <span class=n>style</span> <span class=o>=</span> <span class=n>ConvertStyle</span><span class=p>(</span><span class=n>styleProxy</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>StyleInternal</span> <span class=n>oldStyle</span> <span class=o>=</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=n>StyleInternal</span><span class=o>&gt;</span><span class=p>(</span><span class=o>::</span><span class=n>GetWindowLongW</span><span class=p>(</span><span class=n>m_hWnd</span><span class=p>,</span> <span class=n>GWL_STYLE</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>style</span> <span class=o>!=</span> <span class=n>oldStyle</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Set the new style
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>::</span><span class=n>SetWindowLongW</span><span class=p>(</span><span class=n>m_hWnd</span><span class=p>,</span> <span class=n>GWL_STYLE</span><span class=p>,</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=n>LONG</span><span class=o>&gt;</span><span class=p>(</span><span class=n>style</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Extend frame for resizing (AeroBorderless style)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>IsCompositionEnabled</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>static</span> <span class=k>const</span> <span class=n>MARGINS</span> <span class=n>shadowState</span><span class=p>[</span><span class=mi>2</span><span class=p>]{</span> <span class=p>{</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span> <span class=p>},</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span> <span class=p>}</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>            <span class=o>::</span><span class=n>DwmExtendFrameIntoClientArea</span><span class=p>(</span><span class=n>m_hWnd</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>shadowState</span><span class=p>[</span><span class=n>style</span> <span class=o>!=</span> <span class=n>StyleInternal</span><span class=o>::</span><span class=n>Windowed</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Redraw frame
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>::</span><span class=n>SetWindowPos</span><span class=p>(</span><span class=n>m_hWnd</span><span class=p>,</span> <span class=k>nullptr</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>SWP_FRAMECHANGED</span> <span class=o>|</span> <span class=n>SWP_NOMOVE</span> <span class=o>|</span> <span class=n>SWP_NOSIZE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Show window normal or fullscreen
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>::</span><span class=n>ShowWindow</span><span class=p>(</span><span class=n>m_hWnd</span><span class=p>,</span> <span class=n>fullscreen</span> <span class=o>?</span> <span class=nl>SW_MAXIMIZE</span> <span class=p>:</span> <span class=n>SW_SHOWNORMAL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Update window size
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>RECT</span> <span class=n>rect</span><span class=p>{};</span>
</span></span><span class=line><span class=cl><span class=n>AdjustWindowRect</span><span class=p>(</span><span class=o>&amp;</span><span class=n>rect</span><span class=p>,</span> <span class=p>(</span><span class=n>DWORD</span><span class=p>)</span><span class=n>m_style</span><span class=p>,</span> <span class=n>FALSE</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>m_size</span><span class=p>.</span><span class=n>X</span> <span class=o>=</span> <span class=n>rect</span><span class=p>.</span><span class=n>right</span> <span class=o>-</span> <span class=n>rect</span><span class=p>.</span><span class=n>left</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>m_size</span><span class=p>.</span><span class=n>Y</span> <span class=o>=</span> <span class=n>rect</span><span class=p>.</span><span class=n>bottom</span> <span class=o>-</span> <span class=n>rect</span><span class=p>.</span><span class=n>top</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=window-message-pump class="relative group">Window Message Pump <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#window-message-pump aria-label=Anchor>#</a></span></h3><p>Windows based applications are event-driven. These events are passed into the windows procedure call after they have been processed by the <a href=https://learn.microsoft.com/en-us/windows/win32/winmsg/using-messages-and-message-queues target=_blank rel="noreferrer noopener">windows message pump</a>.</p><p>I don&rsquo;t want the engine/external code to deal with the windows message loop. So I made a function called <code>WantsToClose</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>bool</span> <span class=n>Window</span><span class=o>::</span><span class=n>WantsToClose</span><span class=p>()</span> <span class=k>const</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Windows message pump
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>MSG</span> <span class=n>msg</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=o>::</span><span class=n>PeekMessage</span><span class=p>(</span><span class=o>&amp;</span><span class=n>msg</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>PM_REMOVE</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>::</span><span class=n>TranslateMessage</span><span class=p>(</span><span class=o>&amp;</span><span class=n>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=o>::</span><span class=n>DispatchMessageW</span><span class=p>(</span><span class=o>&amp;</span><span class=n>msg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>msg</span><span class=p>.</span><span class=n>message</span> <span class=o>==</span> <span class=n>WM_QUIT</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This can be used like this. Here I check if the window wants to close (this runs the message pump and dispatches all the events which can be handled manually).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=n>window</span><span class=o>-&gt;</span><span class=n>WantsToClose</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>now</span> <span class=o>=</span> <span class=n>timer</span><span class=p>.</span><span class=n>GetElapsedSeconds</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Perform update code here
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>dt</span> <span class=o>=</span> <span class=n>now</span> <span class=o>-</span> <span class=n>elapsed</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>elapsed</span> <span class=o>=</span> <span class=n>now</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>This is very similar to the actual code being used in the engine to update the application and the window.</p></blockquote><h4 id=window-procedure class="relative group">Window Procedure <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#window-procedure aria-label=Anchor>#</a></span></h4><p>When creating the WNDCLASSEXW I passed in the <code>WndProc</code> as my window procedure function. This is a static member method that like an interface for calling the private <code>MessageRouter</code> function.</p><p>When the event <code>NCCREATE</code> (sent prior WM_CREATE when a window is first created) is sent. I extract the <code>this</code> pointer we passed at the LPARAM when creating the window. Then reinterpret the pointer as this window class and set that as the <strong>Window Long Pointer</strong>. Later, I try to retrieve the long pointer. If succeeded, that means we have our window, on which I call the <code>MessageRouter</code> else call the <code>DefWndProc</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>LRESULT</span> <span class=n>WINAPI</span> <span class=n>Window</span><span class=o>::</span><span class=n>WndProc</span><span class=p>(</span><span class=n>HWND</span> <span class=n>hWnd</span><span class=p>,</span> <span class=n>UINT</span> <span class=n>uMsg</span><span class=p>,</span> <span class=n>WPARAM</span> <span class=n>wParam</span><span class=p>,</span> <span class=n>LPARAM</span> <span class=n>lParam</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>uMsg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>WM_NCCREATE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>LPCREATESTRUCT</span> <span class=n>pCreateStruct</span> <span class=o>=</span> <span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=n>LPCREATESTRUCT</span><span class=o>&gt;</span><span class=p>(</span><span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Window</span><span class=o>*</span> <span class=n>pObj</span>                 <span class=o>=</span> <span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=n>Window</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>pCreateStruct</span><span class=o>-&gt;</span><span class=n>lpCreateParams</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=o>::</span><span class=n>SetWindowLongPtr</span><span class=p>(</span><span class=n>hWnd</span><span class=p>,</span> <span class=n>GWLP_USERDATA</span><span class=p>,</span> <span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=n>LONG_PTR</span><span class=o>&gt;</span><span class=p>(</span><span class=n>pCreateStruct</span><span class=o>-&gt;</span><span class=n>lpCreateParams</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>::</span><span class=n>DefWindowProc</span><span class=p>(</span><span class=n>hWnd</span><span class=p>,</span> <span class=n>uMsg</span><span class=p>,</span> <span class=n>wParam</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Window</span><span class=o>*</span> <span class=n>pObj</span> <span class=o>=</span> <span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=n>Window</span><span class=o>*&gt;</span><span class=p>(</span><span class=o>::</span><span class=n>GetWindowLongPtr</span><span class=p>(</span><span class=n>hWnd</span><span class=p>,</span> <span class=n>GWLP_USERDATA</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>pObj</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>pObj</span><span class=o>-&gt;</span><span class=n>MessageRouter</span><span class=p>(</span><span class=n>hWnd</span><span class=p>,</span> <span class=n>uMsg</span><span class=p>,</span> <span class=n>wParam</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>::</span><span class=n>DefWindowProc</span><span class=p>(</span><span class=n>hWnd</span><span class=p>,</span> <span class=n>uMsg</span><span class=p>,</span> <span class=n>wParam</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=message-router class="relative group">Message Router <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#message-router aria-label=Anchor>#</a></span></h4><p>This the first layer of message indirection where I expose a bit of the low level API to the end user. In my Window class header file have the following defines.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#define NUI_WNDPROC_ARGS Nui::Window*, UINT, WPARAM, LPARAM
</span></span></span><span class=line><span class=cl><span class=cp>#define NUI_WNDPROC_NAMED_ARGS Nui::Window* window, UINT uMsg, WPARAM wParam, LPARAM lParam
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>using</span> <span class=n>WndCallback</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>function</span><span class=o>&lt;</span><span class=n>LRESULT</span><span class=p>(</span><span class=n>NUI_WNDPROC_ARGS</span><span class=p>)</span><span class=o>&gt;</span><span class=p>;</span>
</span></span></code></pre></div><p>Using that type alias, I have a member map where I can call any message the user wants to interject.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>* @brief Window message callbacks
</span></span></span><span class=line><span class=cl><span class=cm>* @note The key is the message
</span></span></span><span class=line><span class=cl><span class=cm>* @note The value is the callback
</span></span></span><span class=line><span class=cl><span class=cm>* @note The callback will be called when the message is received in the MessageRouter
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>map</span><span class=o>&lt;</span><span class=n>U32</span><span class=p>,</span> <span class=n>WndCallback</span><span class=o>&gt;</span> <span class=n>m_callbacks</span><span class=p>;</span>
</span></span></code></pre></div><p>This is how the router function works. It checks if the window message is present in the map and calls the user bound <code>std::function&lt;WndCallback></code> else calls the actual private member method, the <code>MessageHandler</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>LRESULT</span> <span class=n>Window</span><span class=o>::</span><span class=n>MessageRouter</span><span class=p>(</span><span class=n>HWND</span> <span class=n>hWnd</span><span class=p>,</span> <span class=n>UINT</span> <span class=n>uMsg</span><span class=p>,</span> <span class=n>WPARAM</span> <span class=n>wParam</span><span class=p>,</span> <span class=n>LPARAM</span> <span class=n>lParam</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>m_callbacks</span><span class=p>.</span><span class=n>contains</span><span class=p>(</span><span class=n>uMsg</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>m_callbacks</span><span class=p>[</span><span class=n>uMsg</span><span class=p>](</span><span class=k>this</span><span class=p>,</span> <span class=n>uMsg</span><span class=p>,</span> <span class=n>wParam</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nf>MessageHandler</span><span class=p>(</span><span class=n>hWnd</span><span class=p>,</span> <span class=n>uMsg</span><span class=p>,</span> <span class=n>wParam</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=message-handler class="relative group">Message Handler <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#message-handler aria-label=Anchor>#</a></span></h4><p>Finally this is the final function where a Win32 event will arrive to before either being processed internally, dispatched to another system (such as input messages) or be sent to the the default windows procedure call (because we don&rsquo;t care about it).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>LRESULT</span> <span class=n>Window</span><span class=o>::</span><span class=n>MessageHandler</span><span class=p>(</span><span class=n>HWND</span> <span class=n>hWnd</span><span class=p>,</span> <span class=n>UINT</span> <span class=n>uMsg</span><span class=p>,</span> <span class=n>WPARAM</span> <span class=n>wParam</span><span class=p>,</span> <span class=n>LPARAM</span> <span class=n>lParam</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=n>uMsg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>WM_NCCALCSIZE</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>wParam</span> <span class=o>==</span> <span class=n>TRUE</span> <span class=o>&amp;&amp;</span> <span class=n>HasStyleFlag</span><span class=p>((</span><span class=n>DWORD</span><span class=p>)</span><span class=n>m_style</span><span class=p>,</span> <span class=p>(</span><span class=n>DWORD</span><span class=p>)</span><span class=n>Style</span><span class=o>::</span><span class=n>Borderless</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>auto</span><span class=o>&amp;</span> <span class=n>params</span> <span class=o>=</span> <span class=o>*</span><span class=k>reinterpret_cast</span><span class=o>&lt;</span><span class=n>NCCALCSIZE_PARAMS</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>AdjustMaximizedClientRect</span><span class=p>(</span><span class=n>params</span><span class=p>.</span><span class=n>rgrc</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>WM_NCHITTEST</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// When we have no border or title bar, we need to perform our
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// own hit testing to allow resizing and moving.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=n>HasStyleFlag</span><span class=p>((</span><span class=n>DWORD</span><span class=p>)</span><span class=n>m_style</span><span class=p>,</span> <span class=p>(</span><span class=n>DWORD</span><span class=p>)</span><span class=n>Style</span><span class=o>::</span><span class=n>Borderless</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nf>HitTest</span><span class=p>(</span><span class=n>POINT</span><span class=p>{</span> <span class=n>GET_X_LPARAM</span><span class=p>(</span><span class=n>lParam</span><span class=p>),</span> <span class=n>GET_Y_LPARAM</span><span class=p>(</span><span class=n>lParam</span><span class=p>)</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>WM_DESTROY</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>::</span><span class=n>PostQuitMessage</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>WM_CLOSE</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DestroyWindow</span><span class=p>(</span><span class=n>hWnd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>WM_SETFOCUS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>m_isFocused</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>WM_KILLFOCUS</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>m_isFocused</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>::</span><span class=n>DefWindowProc</span><span class=p>(</span><span class=n>hWnd</span><span class=p>,</span> <span class=n>uMsg</span><span class=p>,</span> <span class=n>wParam</span><span class=p>,</span> <span class=n>lParam</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In the above function I handle the following messages</p><ul><li><strong>WM_NCCALCSIZE</strong><ul><li>Sent when the size and position of a window&rsquo;s client area must be calculated.</li><li>Allows me to control the size and area of the the client</li></ul></li><li><strong>WM_NCHITTEST</strong><ul><li>Sent in order to determine what part of the window corresponds to a particular screen coordinate</li><li>Allows me to manually control check for hit test when resizing a bordeless window (when <em>WS_THICKFRAME</em> is enabled)</li></ul></li><li><strong>WM_DESTROY</strong><ul><li>Sent when the window is destroyed</li><li>I use this to trigger the close of the application</li></ul></li><li><strong>WM_CLOSE</strong><ul><li>Sent when the close button or Alt+F3 is pressed</li><li>I use this to destroy the window, causing WM_DESTROY to be sent</li></ul></li><li><strong>WM_SETFOCUS/WM_KILLFOCUS</strong><ul><li>Sent when the window gains or loses input focus</li><li>Use this to check if the window is currently focused, will be usefull when designing the input system</li></ul></li></ul><h4 id=manual-hit-testing class="relative group">Manual Hit Testing <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#manual-hit-testing aria-label=Anchor>#</a></span></h4><p>Here is the function that I call whenever the WM_NCHITTEST is sent</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>LRESULT</span> <span class=n>Window</span><span class=o>::</span><span class=n>HitTest</span><span class=p>(</span><span class=n>POINT</span> <span class=n>cursor</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Identify borders and corners to allow resizing the window.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// Note: On Windows 10, windows behave differently and
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// allow resizing outside the visible window frame.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// This implementation does not replicate that behavior.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>const</span> <span class=n>POINT</span> <span class=n>border</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>::</span><span class=n>GetSystemMetrics</span><span class=p>(</span><span class=n>SM_CXFRAME</span><span class=p>)</span> <span class=o>+</span> <span class=o>::</span><span class=n>GetSystemMetrics</span><span class=p>(</span><span class=n>SM_CXPADDEDBORDER</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=o>::</span><span class=n>GetSystemMetrics</span><span class=p>(</span><span class=n>SM_CYFRAME</span><span class=p>)</span> <span class=o>+</span> <span class=o>::</span><span class=n>GetSystemMetrics</span><span class=p>(</span><span class=n>SM_CXPADDEDBORDER</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>RECT</span> <span class=n>window</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!::</span><span class=n>GetWindowRect</span><span class=p>(</span><span class=n>m_hWnd</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>window</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>HTNOWHERE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>enum</span> <span class=nc>region_mask</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>client</span> <span class=o>=</span> <span class=mb>0b0000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>left</span>   <span class=o>=</span> <span class=mb>0b0001</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>right</span>  <span class=o>=</span> <span class=mb>0b0010</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>top</span>    <span class=o>=</span> <span class=mb>0b0100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>bottom</span> <span class=o>=</span> <span class=mb>0b1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=k>auto</span> <span class=n>result</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=n>left</span>   <span class=o>*</span> <span class=p>(</span><span class=n>cursor</span><span class=p>.</span><span class=n>x</span> <span class=o>&lt;</span> <span class=p>(</span><span class=n>window</span><span class=p>.</span><span class=n>left</span> <span class=o>+</span> <span class=n>border</span><span class=p>.</span><span class=n>x</span><span class=p>))</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>        <span class=n>right</span>  <span class=o>*</span> <span class=p>(</span><span class=n>cursor</span><span class=p>.</span><span class=n>x</span> <span class=o>&gt;=</span> <span class=p>(</span><span class=n>window</span><span class=p>.</span><span class=n>right</span> <span class=o>-</span> <span class=n>border</span><span class=p>.</span><span class=n>x</span><span class=p>))</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>        <span class=n>top</span>    <span class=o>*</span> <span class=p>(</span><span class=n>cursor</span><span class=p>.</span><span class=n>y</span> <span class=o>&lt;</span> <span class=p>(</span><span class=n>window</span><span class=p>.</span><span class=n>top</span> <span class=o>+</span> <span class=n>border</span><span class=p>.</span><span class=n>y</span><span class=p>))</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>        <span class=n>bottom</span> <span class=o>*</span> <span class=p>(</span><span class=n>cursor</span><span class=p>.</span><span class=n>y</span> <span class=o>&gt;=</span> <span class=p>(</span><span class=n>window</span><span class=p>.</span><span class=n>bottom</span> <span class=o>-</span> <span class=n>border</span><span class=p>.</span><span class=n>y</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Return where the mouse hit test
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>switch</span> <span class=p>(</span><span class=n>result</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>left</span>          <span class=p>:</span> <span class=k>return</span> <span class=n>HTLEFT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>right</span>         <span class=p>:</span> <span class=k>return</span> <span class=n>HTRIGHT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>top</span>           <span class=p>:</span> <span class=k>return</span> <span class=n>HTTOP</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>bottom</span>        <span class=p>:</span> <span class=k>return</span> <span class=n>HTBOTTOM</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>top</span> <span class=o>|</span> <span class=nl>left</span>    <span class=p>:</span> <span class=k>return</span> <span class=n>HTTOPLEFT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>top</span> <span class=o>|</span> <span class=nl>right</span>   <span class=p>:</span> <span class=k>return</span> <span class=n>HTTOPRIGHT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>bottom</span> <span class=o>|</span> <span class=nl>left</span> <span class=p>:</span> <span class=k>return</span> <span class=n>HTBOTTOMLEFT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>bottom</span> <span class=o>|</span> <span class=nl>right</span><span class=p>:</span> <span class=k>return</span> <span class=n>HTBOTTOMRIGHT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nl>client</span>        <span class=p>:</span> <span class=k>return</span> <span class=n>HTCLIENT</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span>            <span class=o>:</span> <span class=k>return</span> <span class=n>HTNOWHERE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=conclusion class="relative group">Conclusion <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#conclusion aria-label=Anchor>#</a></span></h2><p>And finally with all that work, we finally have a window. Although one can simply get away with registering a window class and setting the window style to <code>WS_OVERLAPPEDWINDOW</code> along with performing proper message routing (with the message pump). I decided to go ahead and implement a alightly fancier windowing system. Which may or may not be too complex / over the top for basic needs.</p><p>But I am glad you stuck around till the end of the article. This was a long one. In the next one we will look at using the message routing system to create an <strong>Input System</strong>. Which will allow read keyboard and mouse inputs. See you in the next one! </p><div style=display:flex;flex-wrap:wrap;gap:10px><span class=flex><span class="ms-1 rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Programming
</span></span><span class=flex><span class="ms-1 rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Game Engine
</span></span><span class=flex><span class="ms-1 rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">C++</span></span></div></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/posts/mage3/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">MAGE - Part 3</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"></span></span></a></span><span><a class="group flex text-right" href=/posts/mage5_1/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">MAGE - Part 5.1</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"></span></span><span class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&rarr;</span><span class="ltr:hidden rtl:inline">&larr;</span></span></a></span></div></div></footer></article><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2024
Arnav Mehta</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher-0 type=button aria-label="appearance switcher"><div class="flex h-12 w-12 items-center justify-center dark:hidden" title="Switch to dark appearance"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden h-12 w-12 items-center justify-center dark:flex" title="Switch to light appearance"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://arnavmehta3000.github.io/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom px-1 icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>